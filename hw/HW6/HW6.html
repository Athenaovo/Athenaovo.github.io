<!DOCTYPE html>
<html>
    <head>
        <title>Movie Data</title>
        <link rel="stylesheet" href="hw6.css">
    </head>
    <body>
        <div class="header">
            <h1>THE MOVIE DB</h1>
        </div>
        <div class="row">
            <div class="column1">
                    <button class="button" id="homebtn" onclick="homeclicked()">Home&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟶</button>
                    <button class="button" id="searchbtn" onclick="searchclicked()">Search&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;⟶</button>    
            </div>

            <div class="column2" >
                <div class="homedis" id="homedis">
                    <div id="movietrend">
                        <p class="homeshow">Trending Movies</p>
                        <div class="imagebox">
                            <img name="trendslide"/>
                            <p class="trendtext" id="trendtext"></p>

                        </div>
                        

                    </div>
                    <div id="tvshow">
                        <p class="homeshow">TV Shows On-Air Today</p>
                        <div class="imagebox">
                            <img name="tvslide"/>
                            <p class="tvtext" id="tvtext"></p>
                        </div>
                    </div>
                </div>
                
                <div class="search" id="search">
                    <div id="searchbox" class="searchbox">
                        <p class="searchtitle">Search</p>
                            <p><label for="searchbar">Keyword:</label>
                                <input name="searchbar" value="" id="searchbar"/>
                            </p>
                            <p>
                                <label for="searchcategory">Category:</label>
                                <select name="searchcategory" id="searchcate">
                                <option value="" selected="selected"></option>
                                <option value="movies">Movies</option>
                                <option value="tv">TV Shows</option>
                                <option value="moviestv">Movies and TV Shows</option>
                            </select>
                            </p>
                            
                            <button class="formbtn" onclick="searchf()">Search</button>
                            <button class="formbtn" onclick="clearf()" >Clear</button> 
                    </div>
                    <div id="searchresult"></div>
                </div>
                
                <div id="popup" class="popup">
                    <div class="popupcontent">
                        <span id="closetab" onclick="popupclose()">&times;</span>
                        
                        <div id="details" class="details">
                            
                        </div>
                        
                        <div id="cast"class="cast"></div>
                        <div id="reviews"class="reviews"></div>
                    </div>
                    
                </div>

                <div class="footer">
                    <p>Designed and developed by Yingxue, Zhang</p>
                </div>
            </div>
        </div>

        


        <script>
            /* button logic*/
            var resultbox=document.getElementById("searchresult"); 
            function homeclicked(){
                document.getElementById("search").style.display="none";
                document.getElementById('homedis').style.display="block"; 
                document.getElementById('homebtn').style.color="red";
                document.getElementById('searchbtn').style.color="white";
                resultbox.innerHTML=""; 
                clearf(); 
                //another function of clear popup window html;


            }// end of homeclicked 
            function searchclicked(){
                document.getElementById('homedis').style.display="none"; 
                document.getElementById("search").style.display="block";
                document.getElementById('homebtn').style.color="white";
                document.getElementById('searchbtn').style.color="red";
            }
            // first for trend
            var trenddata={}; 
            const myazure="https://acs571.azurewebsites.net/";            
            const HomeDB = new XMLHttpRequest();
            // ******will be changed to Azure
            const movie_trend_url=myazure+"movie_trend"; 
            HomeDB.open("GET",movie_trend_url,false);
            HomeDB.send();
            // console.log(TrendDB.responseText);  working as string 
            trenddata=JSON.parse(HomeDB.responseText);
            
            //end of trend  
            const TVDB = new XMLHttpRequest();
            // ******will be changed to Azure
            const tv_air_url=myazure+"tv_air"; 

            TVDB.open("GET",tv_air_url,false);
            TVDB.send();
            var tvdata={};
            tvdata=JSON.parse(TVDB.responseText);
            changetrendIMG(); 
            changeTVIMG();

            

            var tslidei=0;
            function changeTVIMG(){
                 //console.log("get in function");
                 if(tslidei<5){
                        //console.log("get in image");

                        document.tvslide.src="https://image.tmdb.org/t/p/w780"+tvdata.results[tslidei].backdrop_path; 
                        document.getElementById("tvtext").innerHTML= tvdata.results[tslidei].name+" ("+tvdata.results[tslidei].first_air_date+")";
                        document.getElementById("tvtext").style.padding= "2.3% 0";
                        tslidei++;
                    }
                    else{
                        tslidei=0;
                    }
                    setTimeout(changeTVIMG, 3500);
            }// ned of changetvimg


            var slidei=0;
            function changetrendIMG(){
                    //console.log("get in function");
                    if(slidei<5){
                        //console.log("get in image");
                        document.trendslide.src="https://image.tmdb.org/t/p/w780"+trenddata.results[slidei].backdrop_path; 
                        document.getElementById("trendtext").innerHTML= trenddata.results[slidei].title+" ("+trenddata.results[slidei].release_date+")";
                        document.getElementById("trendtext").style.padding= "2.3% 0";
                        slidei++;
                    }
                    else{
                        slidei=0;
                    }
                    setTimeout(changetrendIMG, 3500);
            }//END OF CHANGEimg

        
            //for search begins 

            function clearf(){
                document.getElementById("searchbar").value=""; 
                document.getElementById("searchcate").value=""; 

            }
            // get genre by id 
            const GENDB = new XMLHttpRequest();
            // ******will be changed to Azure
            const gen_url=myazure+"genre";  

            GENDB.open("GET",gen_url,false);
            GENDB.send();
            var gendata={};
            gendata=JSON.parse(GENDB.responseText);
            //end of genere_movie

            const GENTDB = new XMLHttpRequest();
            // ******will be changed to Azure
            const gent_url=myazure+"genre_tv";  

            GENTDB.open("GET",gent_url,false);
            GENTDB.send();
            var gentdata={};
            gentdata=JSON.parse(GENTDB.responseText);

            var searchDB = new XMLHttpRequest();
            var searchdata={};
            function searchf(){
                var searchres=document.getElementById("searchbar").value; 
                var cateres=document.getElementById("searchcate").value; 
                resultbox.innerHTML="";
                
                if(searchres==""||cateres==""){
                    alert("Please enter valid values.");
                } //endif
                else{
                    if(cateres=="movies"){

                        searchres = searchres.replace(/[ ]/g, "%20");  //replace space
                    
                        // ******will be changed to Azure
                        var searchurl=myazure+"movie_search?query="+searchres; 

                        searchDB.open("GET",searchurl,false);
                        searchDB.send();
                        searchdata=JSON.parse(searchDB.responseText);
                        
                        if(searchdata.results.length==0){
                            resultbox.innerHTML = "<h2>No results found.</h2>"
                            resultbox.style.textAlign="center"; 
                        }

                        else{
                            let length=searchdata.results.length; 
                            if(length>2){
                                resultbox.style.height="100%";

                            }
                            
                            resultbox.style.textAlign="left"; 
                            resultbox.innerHTML = "<p style='font-size:16px;'>Showing results...</h2>"; 
                            
                            resultbox.innerHTML+="<div class='container'></div>";

                            var i=0; 
                            for(i=0; i<length;i++){
                                var row=document.createElement("div");
                                row.setAttribute("class","movierow");
                                var column1 = document.createElement("div");
                                column1.setAttribute("class","moviecolumn1");
                                var post = document.createElement("img");
                                if(searchdata.results[i].poster_path===null){
                                    post.setAttribute("src","movie_placeholder.png");
                                    
                                }
                                else{
                                    post.setAttribute("src","https://image.tmdb.org/t/p/w185"+searchdata.results[i].poster_path);

                                }
                                column1.appendChild(post);

                                var column2 = document.createElement("div");
                                column2.setAttribute("class","moviecolumn2");

                                var mtitle=document.createElement("h2");
                                mtitle.innerHTML=searchdata.results[i].title; 
                                var mgenre=document.createElement("p");
                                //years and genres

                                let gennum=0; 
                                var res ="";
                                for (gennum=0; gennum<searchdata.results[i].genre_ids.length; gennum++){
                                    var j=0; 
                                    for (j=0; j<gendata.genres.length;j++){
                                        

                                        if(gendata.genres[j].id==searchdata.results[i].genre_ids[gennum]){
                                            
                                        res+= gendata.genres[j].name+", "; 
                                        }
                                        
                                        //console.log(res); 
                                    }//end for loop for j 
                                    if (gennum==searchdata.results[i].genre_ids.length-1){
                                         res = res.substring(0, res.length - 2);
                                    }
                                }                           
                                if(searchdata.results[i].release_date !=null){
                                    mgenre.innerHTML = searchdata.results[i].release_date.substring (0,4)+" | "+res; 
                                }                              
                                else{
                                    mgenre.innerHTML = " | "+res; 
                                }   
                                
                                /*  */
                                var mvote = document.createElement("p");
                                mvote.innerHTML = "&#9733; "+(parseFloat(searchdata.results[i].vote_average)/2).toFixed(2).toString()+"/5 ";
                                mvote.setAttribute("style", "margin:0;display:inline;float:left; color:darkred;");
                                var mvotec = document.createElement("p");
                                mvotec.innerHTML = " "+searchdata.results[i].vote_count+" votes";
                                mvotec.setAttribute("style", "padding-left:8px;display:inline;");
                                var mover = document.createElement("p");
                                mover.innerHTML = searchdata.results[i].overview; 
                                var mbtn = document.createElement("button");
                                mbtn.setAttribute("class", "showmorebtn");
                                mbtn.setAttribute("onclick", "popupwindow('movie',"+searchdata.results[i].id+")"); 
                                mbtn.innerHTML = "Show more"; 

                                column2.appendChild(mtitle);
                                column2.appendChild(mgenre);
                                column2.appendChild(mvote);
                                column2.appendChild(mvotec);
                                column2.appendChild(mover);
                                column2.appendChild(mbtn);

                                
                                row.appendChild(column1);
                                row.appendChild(column2);

                                resultbox.appendChild(row);
                            }
                        }

                    }// end of movie search 
                    else if(cateres=="tv"){
                        searchres = searchres.replace(/[ ]/g, "%20");  //replace space
                    
                        // ******will be changed to Azure
                        var searchurl=myazure+"tv_search?query="+searchres; 

                        searchDB.open("GET",searchurl,false);
                        searchDB.send();
                        searchdata=JSON.parse(searchDB.responseText);
                        
                        if(searchdata.results.length==0){
                            resultbox.innerHTML = "<h2 class='noresult'>No results found.</h2>"
                            resultbox.style.textAlign="center"; 
                        }

                        else{
                            let length=searchdata.results.length; 
                            if(length>2){
                                resultbox.style.height="100%";

                            }
                            
                            resultbox.style.textAlign="left"; 
                            resultbox.innerHTML = "<p style='font-size:16px;'>Showing results...</h2>"; 
                            
                            resultbox.innerHTML+="<div class='container'></div>";

                            var i=0; 
                            for(i=0; i<length;i++){
                                var row=document.createElement("div");
                                row.setAttribute("class","movierow");
                                var column1 = document.createElement("div");
                                column1.setAttribute("class","moviecolumn1");
                                var post = document.createElement("img");
                                if(searchdata.results[i].poster_path===null){
                                    post.setAttribute("src","movie_placeholder.png");
                                    
                                }
                                else{
                                    post.setAttribute("src","https://image.tmdb.org/t/p/w185"+searchdata.results[i].poster_path);

                                }
                                column1.appendChild(post);

                                var column2 = document.createElement("div");
                                column2.setAttribute("class","moviecolumn2");

                                var mtitle=document.createElement("h2");
                                mtitle.innerHTML=searchdata.results[i].name; 
                                var mgenre=document.createElement("p");
                                //years and genres

                                let gennum=0; 
                                var res ="";
                                for (gennum=0; gennum<searchdata.results[i].genre_ids.length; gennum++){
                                    var j=0; 
                                    for (j=0; j<gentdata.genres.length;j++){
                                        

                                        if(gentdata.genres[j].id==searchdata.results[i].genre_ids[gennum]){
                                            
                                        res+= gentdata.genres[j].name+", "; 
                                        }
                                        
                                        //console.log(res); 
                                    }//end for loop for j 
                                    if (gennum==searchdata.results[i].genre_ids.length-1){
                                         res = res.substring(0, res.length - 2);
                                    }
                                }
                                
                                if(searchdata.results[i].first_air_date !=null){
                                    mgenre.innerHTML = searchdata.results[i].first_air_date.substring (0,4)+" | "+res; 
                                }                              
                                else{
                                    mgenre.innerHTML = " | "+res; 
                                }
                                
                                /*  */
                                var mvote = document.createElement("p");
                                mvote.innerHTML = "&#9733; "+(parseFloat(searchdata.results[i].vote_average)/2).toFixed(2).toString()+"/5 ";
                                mvote.setAttribute("style", "margin:0;display:inline;float:left; color:darkred;");
                                var mvotec = document.createElement("p");
                                mvotec.innerHTML = " "+searchdata.results[i].vote_count+" votes";
                                mvotec.setAttribute("style", "padding-left:8px;display:inline;");
                                var mover = document.createElement("p");
                                mover.innerHTML = searchdata.results[i].overview; 
                                var mbtn = document.createElement("button");
                                mbtn.setAttribute("class", "showmorebtn");
                                mbtn.setAttribute("onclick", "popupwindow('tv',"+searchdata.results[i].id+")"); 
                                mbtn.innerHTML = "Show more"; 

                                column2.appendChild(mtitle);
                                column2.appendChild(mgenre);
                                column2.appendChild(mvote);
                                column2.appendChild(mvotec);
                                column2.appendChild(mover);
                                column2.appendChild(mbtn);

                                
                                row.appendChild(column1);
                                row.appendChild(column2);

                                resultbox.appendChild(row);
                            }
                        }
                    }//end else if tv 
                    else if(cateres=="moviestv"){
                        //console.log("multi"); 
                        searchres = searchres.replace(/[ ]/g, "%20");  //replace space
                    
                    // ******will be changed to Azure
                    var searchurl=myazure+"multi_search?query="+searchres; 

                    searchDB.open("GET",searchurl,false);
                    searchDB.send();
                    searchdata=JSON.parse(searchDB.responseText);
                    
                    
                    if(searchdata.length==0){
                        resultbox.innerHTML = "<h2 class='noresult'>No results found.</h2>"
                        resultbox.style.textAlign="center"; 
                    }

                    else{
                        let length=searchdata.length; 
                        if(length>2){
                            resultbox.style.height="100%";

                        }
                        
                        resultbox.style.textAlign="left"; 
                        resultbox.innerHTML = "<p style='font-size:16px;'>Showing results...</h2>"; 
                        
                        resultbox.innerHTML+="<div class='container'></div>";

                        var i=0; 
                        for(i=0; i<length;i++){
                            var row=document.createElement("div");
                            row.setAttribute("class","movierow");
                            var column1 = document.createElement("div");
                            column1.setAttribute("class","moviecolumn1");
                            var post = document.createElement("img");
                            if(searchdata[i].poster_path===null){
                                post.setAttribute("src","movie_placeholder.png");
                                
                            }
                            else{
                                post.setAttribute("src","https://image.tmdb.org/t/p/w185"+searchdata[i].poster_path);

                            }
                            column1.appendChild(post);

                            var column2 = document.createElement("div");
                            column2.setAttribute("class","moviecolumn2");

                            if(searchdata[i].media_type =="tv"){
                                var mtitle=document.createElement("h2");
                                mtitle.innerHTML=searchdata[i].name; 
                                var mgenre=document.createElement("p");
                                //years and genres

                                let gennum=0; 
                                var res ="";
                                for (gennum=0; gennum<searchdata[i].genre_ids.length; gennum++){
                                    var j=0; 
                                    for (j=0; j<gentdata.genres.length;j++){
                                        

                                        if(gentdata.genres[j].id==searchdata[i].genre_ids[gennum]){
                                            
                                        res+= gentdata.genres[j].name+", "; 
                                        }
                                        
                                        //console.log(res); 
                                    }//end for loop for j 
                                    if (gennum==searchdata[i].genre_ids.length-1){
                                        res = res.substring(0, res.length - 2);
                                    }
                                }
                                
                                if(searchdata[i].first_air_date !=null){
                                    mgenre.innerHTML = searchdata[i].first_air_date.substring (0,4)+" | "+res; 
                                }                              
                                else{
                                    mgenre.innerHTML = " | "+res; 
                                }
                                
                                /*  */
                                var mvote = document.createElement("p");
                                mvote.innerHTML = "&#9733; "+(parseFloat(searchdata[i].vote_average)/2).toFixed(2).toString()+"/5 ";
                                mvote.setAttribute("style", "margin:0;display:inline;float:left; color:darkred;");
                                var mvotec = document.createElement("p");
                                mvotec.innerHTML = " "+searchdata[i].vote_count+" votes";
                                mvotec.setAttribute("style", "padding-left:8px;display:inline;");
                                var mover = document.createElement("p");
                                mover.innerHTML = searchdata[i].overview; 
                                var mbtn = document.createElement("button");
                                mbtn.setAttribute("class", "showmorebtn");
                                mbtn.setAttribute("onclick", "popupwindow('tv',"+searchdata[i].id+")"); 
                                mbtn.innerHTML = "Show more"; 

                                column2.appendChild(mtitle);
                                column2.appendChild(mgenre);
                                column2.appendChild(mvote);
                                column2.appendChild(mvotec);
                                column2.appendChild(mover);
                                column2.appendChild(mbtn);

                                
                                row.appendChild(column1);
                                row.appendChild(column2);

                                resultbox.appendChild(row);
                            }//end of if media type =tv
                            else if(searchdata[i].media_type =="movie"){

                                var mtitle=document.createElement("h2");
                                mtitle.innerHTML=searchdata[i].title; 
                                var mgenre=document.createElement("p");
                                //years and genres

                                let gennum=0; 
                                var res ="";
                                for (gennum=0; gennum<searchdata[i].genre_ids.length; gennum++){
                                    var j=0; 
                                    //console.log(gendata.genres); 
                                    for (j=0; j<gendata.genres.length;j++){
                                        

                                        if(gendata.genres[j].id==searchdata[i].genre_ids[gennum]){
                                            
                                        res+= gendata.genres[j].name+", "; 
                                        }
                                        
                                        //console.log(res); 
                                    }//end for loop for j 
                                    if (gennum==searchdata[i].genre_ids.length-1){
                                         res = res.substring(0, res.length - 2);
                                    }
                                }                           
                                if(searchdata[i].release_date !=null){
                                    mgenre.innerHTML = searchdata[i].release_date.substring (0,4)+" | "+res; 
                                }                              
                                else{
                                    mgenre.innerHTML = " | "+res; 
                                }   
                                
                                /*  */
                                var mvote = document.createElement("p");
                                mvote.innerHTML = "&#9733; "+(parseFloat(searchdata[i].vote_average)/2).toFixed(2).toString()+"/5 ";
                                mvote.setAttribute("style", "margin:0;display:inline;float:left; color:darkred;");
                                var mvotec = document.createElement("p");
                                mvotec.innerHTML = " "+searchdata[i].vote_count+" votes";
                                mvotec.setAttribute("style", "padding-left:8px;display:inline;");
                                var mover = document.createElement("p");
                                mover.innerHTML = searchdata[i].overview; 
                                var mbtn = document.createElement("button");
                                mbtn.setAttribute("class", "showmorebtn");
                                mbtn.setAttribute("onclick", "popupwindow('movie',"+searchdata[i].id+")"); 
                                mbtn.innerHTML = "Show more"; 

                                column2.appendChild(mtitle);
                                column2.appendChild(mgenre);
                                column2.appendChild(mvote);
                                column2.appendChild(mvotec);
                                column2.appendChild(mover);
                                column2.appendChild(mbtn);

                                
                                row.appendChild(column1);
                                row.appendChild(column2);

                                resultbox.appendChild(row);
                            }//end of if media type =movie

                            
                        }
                    }//end of else inside multi
                    

                    }//end of multi
                
                }//endelse
                    
            }//end of  searchf

            function popupwindow(mediatype, id){
                console.log(mediatype);
                console.log(id);
                document.getElementById("details").innerHTML=""; 
                document.getElementById("cast").innerHTML=""; 
                document.getElementById("reviews").innerHTML=""; 
                document.getElementById("popup").style.display="block"; 
                //http://127.0.0.1:5000/movie_detail?id=284052
                var detailDB = new XMLHttpRequest();
                
                var castDB = new XMLHttpRequest();

                var reviewDB=new XMLHttpRequest(); 

                if(mediatype=="movie"){ // search for movie id 
                    // ******will be changed to Azure
                    const movied_url=myazure+"movie_detail?id="+id; 
                    //var detailDB = new XMLHttpRequest();
                    detailDB.open("GET",movied_url, false);
                    detailDB.send();
                    var detaildata={};
                    detaildata = JSON.parse(detailDB.responseText); 
                    var dimg = document.createElement("img");
                    if(detaildata.backdrop_path==null){
                        dimg.setAttribute("src","movie-placeholder.jpg");                                     
                    }
                    else{
                        dimg.setAttribute("src","https://image.tmdb.org/t/p/w780"+detaildata.backdrop_path); 
                    }
                    var dbox=document.getElementById("details"); 
                    var dtitle=document.createElement("h2");
                    //dtitle.setAttribute("style", "width:1.25vw;"); 
                    dtitle.innerHTML=detaildata.title +"  <a href='https://www.themoviedb.org/movie/"+detaildata.id+"' target='_blank'>&#128712;</a>"; 

                    var dgenre=document.createElement("p");
                    dgenre.setAttribute("style", "font-size:18px;"); 

                    //years 
                    let gennum=0; 
                    var res ="";
                    for (gennum=0; gennum<detaildata.genres.length; gennum++){                                      
                            res+= detaildata.genres[gennum].name+", ";                     
                        if (gennum==detaildata.genres.length-1){
                            res = res.substring(0, res.length - 2);
                        }
                    }//end of for loop 
                                    
                    if(detaildata.release_date !=null){
                    dgenre.innerHTML = detaildata.release_date.substring (0,4)+" | "+res; 
                    }                              
                    else{
                    dgenre.innerHTML = " | "+res; 
                    }
                    


                    var dvote = document.createElement("p");
                    dvote.innerHTML = "&#9733; "+(parseFloat(detaildata.vote_average)/2).toFixed(2).toString()+"/5 ";
                    dvote.setAttribute("style", "margin:0;display:inline;float:left; color:darkred;");
                    var dvotec = document.createElement("p");
                    dvotec.innerHTML = " "+detaildata.vote_count+" votes";
                    dvotec.setAttribute("style", "padding-left:8px;display:inline;");
                    var dover = document.createElement("p");
                    dover.setAttribute("style", "padding-top: 10px; padding-bottom:5px; font-size:18px;"); 
                    dover.innerHTML = detaildata.overview; 
                    var dlan = document.createElement("p");
                    dlan.setAttribute("style", "font-style:italic");
                    let lannum=0; 
                    var lan ="";
                    for (lannum=0; lannum<detaildata.spoken_languages.length; lannum++){                                      
                            lan+= detaildata.spoken_languages[lannum].english_name+", ";                     
                        if (lannum==detaildata.spoken_languages.length-1){
                            lan = lan.substring(0, lan.length - 2);
                        }
                    }//end of for loop 
                    dlan.innerHTML = "Spoken languages: "+lan; 
                    /*  
                    */
                    dbox.appendChild(dimg);
                    dbox.appendChild(dtitle); 
                    dbox.appendChild(dgenre); 
                    dbox.appendChild(dvote);
                    dbox.appendChild(dvotec); 
                    dbox.appendChild(dover); 
                    dbox.appendChild(dlan); 

                    //cast
                    const casturl=myazure+"movie_cast?id="+id; 

                    castDB.open("GET",casturl, false);
                    castDB.send();
                    var castdata={};
                    castdata = JSON.parse(castDB.responseText); 
                    var row1=document.createElement("div");
                    row1.setAttribute("class","castrow");
                    var row2=document.createElement("div");
                    row2.setAttribute("class","castrow");
                    var casts=castdata.cast; 

                    if(casts!=null){
                        var num=0;
                        for(num=0; num<8; num++){
                            
                            var column = document.createElement("div");
                            column.setAttribute("class","castcolumn");
                            if(casts[num]!=null){
                                var cimg = document.createElement("img");
                                if(casts[num].profile_path==null){
                                    cimg.setAttribute("src","person-placeholder.png");                                     
                                }
                                else{
                                    cimg.setAttribute("src","https://image.tmdb.org/t/p/w185"+casts[num].profile_path); 
                                }
                                var cname = document.createElement("p");
                                cname.setAttribute("style"," font-weight: bold; font-size:14px; "); 
                                cname.innerHTML = casts[num].name; 
                                var ca = document.createElement("p");
                                ca.setAttribute("style"," font-size:16px; "); 
                                ca.innerHTML = "AS";
                                var cc = document.createElement("p");
                                cc.setAttribute("style"," font-size:14px; "); 
                                cc.innerHTML = casts[num].character;

                                column.appendChild(cimg); 
                                column.appendChild(cname);
                                column.appendChild(ca);
                                column.appendChild(cc);
                            }
                            if(num<4){
                                row1.appendChild(column);
                            }
                            else{
                                row2.appendChild(column);
                            }
                        }
                        document.getElementById("cast").appendChild(row1);
                        document.getElementById("cast").appendChild(row2);
                    }

                    //reviews
                    const mrev_url=myazure+"movie_review?id="+id; 
                    //var detailDB = new XMLHttpRequest();
                    reviewDB.open("GET",mrev_url, false);
                    reviewDB.send();
                    var revdata={};
                    revdata = JSON.parse(reviewDB.responseText); 
                    reviews = revdata.results; 
                    var first=document.createElement("h2");
                    first.innerHTML="Reviews";
                    
                    var num=0;
                    document.getElementById("reviews").appendChild(first);
                    if(reviews.length<5){// not enough for 5 comments; 
                        for(num=0; num<reviews.length; num++){
                            var creviews = document.createElement("div");
                            creviews.setAttribute("class","reviewbox");
                            var name=document.createElement("p");  
                            name.innerHTML = "<span style='font-weight: bold;'>"+reviews[num].author_details.username+"</span>"+"  on "+reviews[num].created_at.substring (0,10).replace(/[-]/g, "/"); 
                            creviews.appendChild(name); 
                            
                            if(reviews[num].author_details.rating!=null){
                                var vote = document.createElement("p");
                                vote.innerHTML = "&#9733; "+(parseFloat(reviews[num].author_details.rating)/2).toFixed(2).toString()+"/5 ";
                                vote.setAttribute("style", "margin:0;color:darkred;");
                                creviews.appendChild(vote); 
                            }
                            var vc = document.createElement("p");
                            vc.setAttribute("class", "reviewcon"); 
                            vc.innerHTML = reviews[num].content;
                            creviews.appendChild(vc); 
                            botline=document.createElement("div");
                            botline.setAttribute("class","botline");
                            creviews.appendChild(botline); 

                            document.getElementById("reviews").appendChild(creviews); 

                        }
                    }
                    else{
                        for(num=0; num<5; num++){
                            var creviews = document.createElement("div");
                            creviews.setAttribute("class","reviewbox");
                            var name=document.createElement("p");  
                            name.innerHTML = "<span style='font-weight: bold;'>"+reviews[num].author_details.username+"</span>"+"  on "+reviews[num].created_at.substring(0,10).replace(/[-]/g, "/"); 
                            creviews.appendChild(name); 
                            if(reviews[num].author_details.rating!=null){
                                var vote = document.createElement("p");
                                vote.innerHTML = "&#9733; "+(parseFloat(reviews[num].author_details.rating)/2).toFixed(2).toString()+"/5 ";
                                vote.setAttribute("style", "margin:0;color:darkred;");
                                creviews.appendChild(vote); 
                            }
                            var vc = document.createElement("p");
                            vc.setAttribute("class", "reviewcon"); 
                            vc.innerHTML = reviews[num].content;
                            creviews.appendChild(vc); 
                            botline=document.createElement("div");
                            botline.setAttribute("class","botline");
                            creviews.appendChild(botline); 

                            document.getElementById("reviews").appendChild(creviews); 
                        }

                    }//end of else for moview

                    


                    

            }// end of movie option

            else{ //begin tv option 
                // ******will be changed to Azure
                const tvd_url=myazure+"tv_detail?id="+id; 
                
                detailDB.open("GET",tvd_url, false);
                detailDB.send();
                var detaildata={};
                detaildata = JSON.parse(detailDB.responseText); 
                var dimg = document.createElement("img");
                if(detaildata.backdrop_path==null){
                    dimg.setAttribute("src","movie-placeholder.jpg");                                     
                }
                else{
                    dimg.setAttribute("src","https://image.tmdb.org/t/p/w780"+detaildata.backdrop_path); 
                }
                var dbox=document.getElementById("details"); 
                var dtitle=document.createElement("h2");
                //dtitle.setAttribute("style", "width:1.25vw;"); 
                
                dtitle.innerHTML=detaildata.name+"  <a href='https://www.themoviedb.org/tv/"+detaildata.id+"' target='_blank'>&#128712;</a>"; ; 
                var dgenre=document.createElement("p");
                dgenre.setAttribute("style", "font-size:18px;"); 

                //years 
                let gennum=0; 
                var res ="";
                for (gennum=0; gennum<detaildata.genres.length; gennum++){                                      
                        res+= detaildata.genres[gennum].name+", ";                     
                    if (gennum==detaildata.genres.length-1){
                        res = res.substring(0, res.length - 2);
                    }
                }//end of for loop 
                                
                if(detaildata.first_air_date !=null){
                dgenre.innerHTML = detaildata.first_air_date.substring (0,4)+" | "+res; 
                }                              
                else{
                dgenre.innerHTML = " | "+res; 
                }

                var dvote = document.createElement("p");
                dvote.innerHTML = "&#9733; "+(parseFloat(detaildata.vote_average)/2).toFixed(2).toString()+"/5 ";
                dvote.setAttribute("style", "margin:0;display:inline;float:left; color:darkred;");
                var dvotec = document.createElement("p");
                dvotec.innerHTML = " "+detaildata.vote_count+" votes";
                dvotec.setAttribute("style", "padding-left:8px;display:inline;");
                var dover = document.createElement("p");
                dover.setAttribute("style", "padding-top: 10px; padding-bottom:5px; font-size:18px;"); 
                dover.innerHTML = detaildata.overview; 
                var dlan = document.createElement("p");
                dlan.setAttribute("style", "font-style:italic");
                let lannum=0; 
                var lan ="";
                for (lannum=0; lannum<detaildata.spoken_languages.length; lannum++){                                      
                        lan+= detaildata.spoken_languages[lannum].english_name+", ";                     
                    if (lannum==detaildata.spoken_languages.length-1){
                        lan = lan.substring(0, lan.length - 2);
                    }
                }//end of for loop 
                dlan.innerHTML = "Spoken languages: "+lan; 
                /*  
                */
                dbox.appendChild(dimg);
                dbox.appendChild(dtitle); 
                dbox.appendChild(dgenre); 
                dbox.appendChild(dvote);
                dbox.appendChild(dvotec); 
                dbox.appendChild(dover); 
                dbox.appendChild(dlan); 

                //cast
                const castturl=myazure+"tv_cast?id="+id; 

                castDB.open("GET",castturl, false);
                castDB.send();
                var castdata={};
                castdata = JSON.parse(castDB.responseText); 
                var row1=document.createElement("div");
                row1.setAttribute("class","castrow");
                var row2=document.createElement("div");
                row2.setAttribute("class","castrow");
                var casts=castdata.cast; 

                if(casts!=null){
                    var num=0;
                    for(num=0; num<8; num++){
                        
                        var column = document.createElement("div");
                        column.setAttribute("class","castcolumn");
                        if(casts[num]!=null){
                            var cimg = document.createElement("img");
                            if(casts[num].profile_path==null){
                                cimg.setAttribute("src","person-placeholder.png");                                     
                            }
                            else{
                                cimg.setAttribute("src","https://image.tmdb.org/t/p/w185"+casts[num].profile_path); 
                            }
                            var cname = document.createElement("p");
                            cname.setAttribute("style"," font-weight: bold; font-size:14px; "); 
                            cname.innerHTML = casts[num].name; 
                            var ca = document.createElement("p");
                            ca.setAttribute("style"," font-size:16px; "); 
                            ca.innerHTML = "AS";
                            var cc = document.createElement("p");
                            cc.setAttribute("style"," font-size:14px; "); 
                            cc.innerHTML = casts[num].character;

                            column.appendChild(cimg); 
                            column.appendChild(cname);
                            column.appendChild(ca);
                            column.appendChild(cc);
                        }
                        if(num<4){
                            row1.appendChild(column);
                        }
                        else{
                            row2.appendChild(column);
                        }
                    }
                    document.getElementById("cast").appendChild(row1);
                    document.getElementById("cast").appendChild(row2);
                }
                //review 

                const trev_url=myazure+"tv_review?id="+id; 
                    //var detailDB = new XMLHttpRequest();
                    reviewDB.open("GET",trev_url, false);
                    reviewDB.send();
                    var revdata={};
                    revdata = JSON.parse(reviewDB.responseText); 
                    reviews = revdata.results; 
                    var first=document.createElement("h2");
                    first.innerHTML="Reviews";
                    
                    var num=0;
                    document.getElementById("reviews").appendChild(first);
                    if(reviews.length<5){// not enough for 5 comments; 
                        for(num=0; num<reviews.length; num++){
                            var creviews = document.createElement("div");
                            creviews.setAttribute("class","reviewbox");
                            var name=document.createElement("p");  
                            name.innerHTML = "<span style='font-weight: bold;'>"+reviews[num].author_details.username+"</span>"+"  on "+reviews[num].created_at.substring (0,10).replace(/[-]/g, "/"); 
                            creviews.appendChild(name); 
                            
                            if(reviews[num].author_details.rating!=null){
                                var vote = document.createElement("p");
                                vote.innerHTML = "&#9733; "+(parseFloat(reviews[num].author_details.rating)/2).toFixed(2).toString()+"/5 ";
                                vote.setAttribute("style", "margin:0;color:darkred;");
                                creviews.appendChild(vote); 
                            }
                            var vc = document.createElement("p");
                            vc.setAttribute("class", "reviewcon"); 
                            vc.innerHTML = reviews[num].content;
                            creviews.appendChild(vc); 
                            botline=document.createElement("div");
                            botline.setAttribute("class","botline");
                            creviews.appendChild(botline); 

                            document.getElementById("reviews").appendChild(creviews); 

                        }
                    }
                    else{
                        for(num=0; num<5; num++){
                            var creviews = document.createElement("div");
                            creviews.setAttribute("class","reviewbox");
                            var name=document.createElement("p");  
                            name.innerHTML = "<span style='font-weight: bold;'>"+reviews[num].author_details.username+"</span>"+"  on "+reviews[num].created_at.substring (0,10).replace(/[-]/g, "/"); 
                            creviews.appendChild(name); 
                            if(reviews[num].author_details.rating!=null){
                                var vote = document.createElement("p");
                                vote.innerHTML = "&#9733; "+(parseFloat(reviews[num].author_details.rating)/2).toFixed(2).toString()+"/5 ";
                                vote.setAttribute("style", "margin:0;color:darkred;");
                                creviews.appendChild(vote); 
                            }
                            var vc = document.createElement("p");
                            vc.setAttribute("class", "reviewcon"); 
                            vc.innerHTML = reviews[num].content;
                            creviews.appendChild(vc); 
                            botline=document.createElement("div");
                            botline.setAttribute("class","botline");
                            creviews.appendChild(botline); 

                            document.getElementById("reviews").appendChild(creviews); 
                        }

                    }//end of else for tvvioew

            }//end of tv
            
            }//end of popupwindow 

            function popupclose(){
                document.getElementById("popup").style.display = 'none';
            }




            

                
               
                
            


           
        </script>
    </body>
</html>